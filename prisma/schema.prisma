// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ═══════════════════════════════════════════════════════════════
// BOOKINGS & QUOTES
// ═══════════════════════════════════════════════════════════════

model Booking {
  id              String   @id @default(uuid())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Contact Information
  name            String
  email           String
  phone           String
  address         String
  postcode        String

  // Service Details
  serviceType     String
  propertyType    String
  propertySize    String?
  numberOfRooms   Int?
  squareMeters    Int?
  stainRemoval    Boolean  @default(false)
  additionalNotes String?  @db.Text

  // Photos
  photoUrls       String[] @default([])

  // Scheduling
  preferredDate   DateTime

  // Pricing Breakdown
  distance        Float    // Miles from Manchester
  travelCost      Float    // GBP
  serviceCost     Float    // GBP
  totalCost       Float    // GBP

  // Status Management
  status          BookingStatus @default(PENDING)
  adminNotes      String?  @db.Text
  completedAt     DateTime?

  @@map("bookings")
  @@index([status])
  @@index([createdAt])
  @@index([preferredDate])
  @@index([email])
}

enum BookingStatus {
  PENDING      // Awaiting admin review
  CONFIRMED    // Admin confirmed
  IN_PROGRESS  // Job in progress
  COMPLETED    // Job finished
  CANCELLED    // Cancelled by admin or customer
}

// ═══════════════════════════════════════════════════════════════
// CONTENT MANAGEMENT
// ═══════════════════════════════════════════════════════════════

model Service {
  id              String   @id @default(uuid())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  slug            String   @unique // carpet-cleaning, rug-cleaning, etc.
  name            String   // "Carpet Cleaning"
  shortDescription String  @db.Text
  longDescription  String  @db.Text

  // SEO
  metaTitle       String
  metaDescription String
  keywords        String[] @default([])

  // Pricing Display
  basePriceFrom   Float
  priceUnit       String   // "per room", "per sqm", etc.

  // Features
  features        String[] @default([])

  // Display
  iconName        String   // For UI icon selection
  displayOrder    Int      @default(0)
  isActive        Boolean  @default(true)

  @@map("services")
  @@index([slug])
}

model Review {
  id              String   @id @default(uuid())
  createdAt       DateTime @default(now())

  customerName    String
  serviceType     String   // Links to Service.slug
  rating          Int      // 1-5 stars
  reviewText      String   @db.Text
  location        String   // "Manchester", "Stockport", etc.

  // Display
  isApproved      Boolean  @default(false)
  isFeatured      Boolean  @default(false)
  displayOrder    Int      @default(0)

  // Optional booking link
  bookingId       String?

  @@map("reviews")
  @@index([isApproved, isFeatured])
}

model GalleryItem {
  id              String   @id @default(uuid())
  createdAt       DateTime @default(now())

  title           String
  description     String?  @db.Text

  beforeImageUrl  String
  afterImageUrl   String

  serviceType     String   // Links to Service.slug
  location        String   // Town/city

  // Display
  isApproved      Boolean  @default(false)
  isFeatured      Boolean  @default(false)
  displayOrder    Int      @default(0)

  @@map("gallery_items")
  @@index([isApproved, isFeatured])
}

model FAQ {
  id              String   @id @default(uuid())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  question        String   @db.Text
  answer          String   @db.Text
  category        String   // "booking", "pricing", "services", "general"

  // Display
  displayOrder    Int      @default(0)
  isActive        Boolean  @default(true)

  @@map("faqs")
  @@index([category])
}

model BlogPost {
  id              String   @id @default(uuid())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  publishedAt     DateTime?

  slug            String   @unique
  title           String
  excerpt         String   @db.Text
  content         String   @db.Text // Markdown or HTML

  // SEO
  metaTitle       String
  metaDescription String
  keywords        String[] @default([])

  // Taxonomy
  category        String   // "cleaning-tips", "industry-news", etc.
  tags            String[] @default([])

  // Media
  featuredImageUrl String?

  // Publishing
  authorName      String   @default("Method Clean Team")
  isPublished     Boolean  @default(false)

  @@map("blog_posts")
  @@index([slug])
  @@index([isPublished, publishedAt])
}

// ═══════════════════════════════════════════════════════════════
// ADMIN & CONFIGURATION
// ═══════════════════════════════════════════════════════════════

model AdminUser {
  id              String   @id @default(uuid())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  email           String   @unique
  name            String
  role            AdminRole @default(ADMIN)

  // Linked to Supabase Auth
  supabaseUserId  String   @unique

  lastLoginAt     DateTime?
  isActive        Boolean  @default(true)

  @@map("admin_users")
}

enum AdminRole {
  SUPER_ADMIN
  ADMIN
  VIEWER
}

model Setting {
  id              String   @id @default(uuid())
  key             String   @unique // "base_price_carpet_per_room"
  value           String   // Stored as string, parsed as needed
  type            String   // "number", "string", "boolean", "json"
  description     String?

  updatedAt       DateTime @updatedAt

  @@map("settings")
}
